---
title: Utilities
description: Helper utilities, cluster detection, query optimization, and development tools for Solana applications.
---

# Utilities

The **Utils** module (`@connectorkit/sdk/utils`) provides essential utility functions for cluster detection, query optimization, and common Solana operations.

## Cluster Detection

Automatically detect Solana networks from RPC URLs and provide network-specific information.

### Detecting Clusters

```typescript
import { detectClusterFromRpcUrl, getClusterInfo } from '@connectorkit/sdk/utils'

// Detect cluster from RPC URL
const cluster = detectClusterFromRpcUrl('https://api.devnet.solana.com')
console.log(cluster) // 'devnet'

// Get full cluster information
const clusterInfo = getClusterInfo('https://api.mainnet-beta.solana.com')
console.log(clusterInfo)
// {
//   cluster: 'mainnet-beta',
//   name: 'Mainnet Beta',
//   rpcUrl: 'https://api.mainnet-beta.solana.com',
//   explorerUrl: 'https://explorer.solana.com',
//   isMainnet: true,
//   isDevnet: false,
//   isTestnet: false,
//   isLocal: false
// }
```

### Supported RPC Patterns

The cluster detection recognizes common RPC providers:

```typescript
// Official Solana endpoints
detectClusterFromRpcUrl('https://api.mainnet-beta.solana.com') // 'mainnet-beta'
detectClusterFromRpcUrl('https://api.devnet.solana.com') // 'devnet' 
detectClusterFromRpcUrl('https://api.testnet.solana.com') // 'testnet'

// Local development
detectClusterFromRpcUrl('http://localhost:8899') // 'localnet'
detectClusterFromRpcUrl('http://127.0.0.1:8899') // 'localnet'

// Third-party providers
detectClusterFromRpcUrl('https://rpc.ankr.com/solana') // 'mainnet-beta'
detectClusterFromRpcUrl('https://rpc.ankr.com/solana_devnet') // 'devnet'

// Custom endpoints
detectClusterFromRpcUrl('https://my-custom-rpc.com') // 'custom'
```

### Official RPC Endpoints

```typescript
import { OFFICIAL_RPC_URLS, isOfficialRpc } from '@connectorkit/sdk/utils'

// Access official endpoints
console.log(OFFICIAL_RPC_URLS.mainnet) // 'https://api.mainnet-beta.solana.com'
console.log(OFFICIAL_RPC_URLS.devnet)  // 'https://api.devnet.solana.com'

// Check if RPC is official
const isOfficial = isOfficialRpc('https://api.devnet.solana.com') // true
const isCustom = isOfficialRpc('https://my-rpc.com') // false
```

## Explorer Integration

Generate Solana Explorer URLs for addresses and transactions.

### Explorer URLs

```typescript
import { getExplorerUrl } from '@connectorkit/sdk/utils'

const address = '4fYNw3dojWmQ4dUQFNUTcgd6fj6vKWUvkEvPEqKK5dL'
const signature = '5j7s5i27...transaction-signature'

// Address URLs
const addressUrl = getExplorerUrl(address, 'https://api.devnet.solana.com', 'address')
console.log(addressUrl) // 'https://explorer.solana.com/address/4fY...?cluster=devnet'

// Transaction URLs  
const txUrl = getExplorerUrl(signature, 'https://api.mainnet-beta.solana.com', 'tx')
console.log(txUrl) // 'https://explorer.solana.com/tx/5j7s5i27...?cluster=mainnet'
```

### Dynamic Explorer Links

```tsx
import { getExplorerUrl, getClusterInfo } from '@connectorkit/sdk/utils'

function ExplorerLink({ 
  address, 
  rpcUrl, 
  children 
}: { 
  address: string
  rpcUrl?: string
  children: React.ReactNode 
}) {
  const explorerUrl = getExplorerUrl(address, rpcUrl, 'address')
  const clusterInfo = getClusterInfo(rpcUrl)
  
  return (
    <a 
      href={explorerUrl}
      target="_blank"
      rel="noopener noreferrer"
      className="text-blue-500 hover:underline"
    >
      {children}
      <span className="text-xs text-gray-500 ml-1">
        ({clusterInfo.name})
      </span>
    </a>
  )
}

// Usage
<ExplorerLink address="4fYNw..." rpcUrl="https://api.devnet.solana.com">
  View on Explorer
</ExplorerLink>
```

## Faucet Integration

Access devnet and testnet faucets for development.

### Faucet URLs

```typescript
import { getFaucetUrl } from '@connectorkit/sdk/utils'

const devnetFaucet = getFaucetUrl('devnet')
console.log(devnetFaucet) // 'https://faucet.solana.com'

const testnetFaucet = getFaucetUrl('testnet')  
console.log(testnetFaucet) // 'https://faucet.solana.com'

const mainnetFaucet = getFaucetUrl('mainnet-beta')
console.log(mainnetFaucet) // null (no faucet for mainnet)
```

### Faucet Component

```tsx
import { getFaucetUrl, getClusterInfo } from '@connectorkit/sdk/utils'

function FaucetButton({ rpcUrl }: { rpcUrl?: string }) {
  const clusterInfo = getClusterInfo(rpcUrl)
  const faucetUrl = getFaucetUrl(clusterInfo.cluster)
  
  if (!faucetUrl) {
    return null // No faucet for this network
  }
  
  return (
    <a
      href={faucetUrl}
      target="_blank"
      rel="noopener noreferrer"
      className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
    >
      Get {clusterInfo.name} SOL
    </a>
  )
}
```

## Query Key Optimization

Optimized React Query keys for efficient caching and invalidation.

### Available Query Keys

```typescript
import { queryKeys } from '@connectorkit/sdk/utils'

// Account queries
const balanceKey = queryKeys.balance(address, rpcUrl)
const accountKey = queryKeys.account(address)

// Token queries  
const tokenAccountKey = queryKeys.tokenAccount(address, mint)
const tokenBalanceKey = queryKeys.tokenBalance(tokenAccount)

// Network queries
const blockHeightKey = queryKeys.blockHeight(rpcUrl)
const latestBlockhashKey = queryKeys.latestBlockhash(rpcUrl)

// Transaction queries
const signatureStatusKey = queryKeys.signatureStatuses([signature])
```

### Cache Invalidation

```typescript
import { useQueryClient } from '@tanstack/react-query'
import { queryKeys } from '@connectorkit/sdk/utils'

function useInvalidateBalance() {
  const queryClient = useQueryClient()
  
  const invalidateBalance = (address: string, rpcUrl?: string) => {
    // Invalidate specific balance
    queryClient.invalidateQueries({
      queryKey: queryKeys.balance(address, rpcUrl)
    })
    
    // Invalidate all balances for this address
    queryClient.invalidateQueries({
      queryKey: queryKeys.balance(address)
    })
  }
  
  const invalidateAllBalances = () => {
    // Invalidate all balance queries
    queryClient.invalidateQueries({
      queryKey: [...queryKeys.all, 'balance']
    })
  }
  
  return { invalidateBalance, invalidateAllBalances }
}
```

### Query Key Patterns

```typescript
// All SDK queries start with 'arc'
queryKeys.all // ['arc']

// Hierarchical structure for efficient invalidation
queryKeys.balance(address, rpcUrl) 
// ['arc', 'balance', { address, rpcUrl }]

queryKeys.tokenAccount(address, mint)
// ['arc', 'tokenAccount', { address, mint }]

// Invalidate all queries for an address
queryClient.invalidateQueries({
  predicate: (query) => {
    const [scope, type, params] = query.queryKey
    return scope === 'arc' && params?.address === targetAddress
  }
})
```

## Type Definitions

### Cluster Types

```typescript
export type Cluster = 'mainnet-beta' | 'devnet' | 'testnet' | 'localnet' | 'custom'

export interface ClusterInfo {
  cluster: Cluster
  name: string
  rpcUrl: string
  explorerUrl: string
  isMainnet: boolean
  isDevnet: boolean
  isTestnet: boolean
  isLocal: boolean
}
```

### Utility Functions

```typescript
// Cluster detection
export function detectClusterFromRpcUrl(rpcUrl: string): Cluster
export function getClusterInfo(rpcUrl?: string): ClusterInfo
export function isOfficialRpc(rpcUrl: string): boolean

// Explorer integration
export function getExplorerUrl(
  addressOrSignature: string, 
  rpcUrl?: string,
  type?: 'address' | 'tx'
): string

// Faucet integration
export function getFaucetUrl(cluster: Cluster): string | null
```

## Best Practices

### Cluster Detection

```typescript
// ✅ Good - Handle all cluster types
function getNetworkConfig(rpcUrl: string) {
  const clusterInfo = getClusterInfo(rpcUrl)
  
  switch (clusterInfo.cluster) {
    case 'mainnet-beta':
      return { commitment: 'finalized', retries: 3 }
    case 'devnet':
    case 'testnet':
      return { commitment: 'confirmed', retries: 2 }
    case 'localnet':
      return { commitment: 'processed', retries: 1 }
    case 'custom':
      return { commitment: 'confirmed', retries: 2 }
    default:
      return { commitment: 'confirmed', retries: 2 }
  }
}

// ❌ Bad - Assuming cluster type
function getCommitment(rpcUrl: string) {
  if (rpcUrl.includes('mainnet')) {
    return 'finalized' // What about custom mainnet RPCs?
  }
  return 'confirmed'
}
```

### Query Key Usage

```typescript
// ✅ Good - Use provided query keys
import { queryKeys } from '@connectorkit/sdk/utils'

const { data } = useQuery({
  queryKey: queryKeys.balance(address, rpcUrl),
  queryFn: () => getBalance(address)
})

// ❌ Bad - Custom query keys that don't align with SDK
const { data } = useQuery({
  queryKey: ['balance', address], // Doesn't match SDK patterns
  queryFn: () => getBalance(address)
})
```

### Explorer Links

```typescript
// ✅ Good - Generate links dynamically
function TransactionLink({ signature, rpcUrl }: { signature: string, rpcUrl?: string }) {
  const explorerUrl = getExplorerUrl(signature, rpcUrl, 'tx')
  return <a href={explorerUrl}>View Transaction</a>
}

// ❌ Bad - Hardcoded explorer URLs
function TransactionLink({ signature }: { signature: string }) {
  const explorerUrl = `https://explorer.solana.com/tx/${signature}` // Assumes mainnet
  return <a href={explorerUrl}>View Transaction</a>
}
```

## Usage Examples

### Network Switcher Component

```tsx
import { OFFICIAL_RPC_URLS, getClusterInfo } from '@connectorkit/sdk/utils'

function NetworkSwitcher({ currentRpc, onRpcChange }: {
  currentRpc: string
  onRpcChange: (rpc: string) => void
}) {
  const networks = [
    { name: 'Mainnet', rpc: OFFICIAL_RPC_URLS['mainnet-beta'] },
    { name: 'Devnet', rpc: OFFICIAL_RPC_URLS.devnet },
    { name: 'Testnet', rpc: OFFICIAL_RPC_URLS.testnet },
    { name: 'Localhost', rpc: OFFICIAL_RPC_URLS.localnet }
  ]
  
  const currentCluster = getClusterInfo(currentRpc)
  
  return (
    <select 
      value={currentRpc}
      onChange={(e) => onRpcChange(e.target.value)}
      className="border rounded p-2"
    >
      {networks.map(({ name, rpc }) => (
        <option key={rpc} value={rpc}>
          {name} {currentRpc === rpc && '(current)'}
        </option>
      ))}
    </select>
  )
}
```

### Development Helper

```tsx
import { getClusterInfo, getFaucetUrl } from '@connectorkit/sdk/utils'

function DevelopmentHelper({ rpcUrl }: { rpcUrl?: string }) {
  const clusterInfo = getClusterInfo(rpcUrl)
  const faucetUrl = getFaucetUrl(clusterInfo.cluster)
  
  if (clusterInfo.isMainnet) {
    return null // Don't show dev tools on mainnet
  }
  
  return (
    <div className="bg-yellow-100 border border-yellow-400 rounded p-4 mb-4">
      <h3 className="font-bold text-yellow-800">Development Mode</h3>
      <p>You're connected to {clusterInfo.name}</p>
      
      {faucetUrl && (
        <a 
          href={faucetUrl}
          target="_blank"
          className="text-blue-600 hover:underline"
        >
          Get test SOL from faucet →
        </a>
      )}
    </div>
  )
}
```

## Next Steps

- **[React Integration](/docs/hooks/react)** - Use utilities with React hooks
- **[Hooks Reference](/docs/hooks/use-cluster)** - See cluster utilities in action
- **[Core](/docs/hooks/core)** - Advanced RPC and error handling
