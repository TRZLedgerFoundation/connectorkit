---
title: Core Infrastructure
description: Foundational infrastructure with enterprise-grade RPC management, error handling, and provider system.
---

# Core Infrastructure

The **Core** module (`@connectorkit/sdk/core`) provides the foundational infrastructure that powers the entire SDK. It includes enterprise-grade RPC management, error handling, and integrates the provider system.

## RPC Connection Manager

The RPC Manager solves a critical performance issue where traditional Solana apps create 50+ RPC connections per page. Our singleton connection pool reduces this to 1-2 shared connections.

### Key Benefits

- **Performance**: 10x fewer RPC connections
- **Rate Limit Protection**: Prevents provider throttling
- **Memory Management**: Automatic cleanup prevents leaks
- **Cost Reduction**: Fewer connections = lower provider costs

### Usage

```typescript
import { getSharedRpc, getRpcStats } from '@connectorkit/sdk/core'

// Get a shared RPC connection (reuses existing if available)
const rpc = getSharedRpc('https://api.devnet.solana.com', 'confirmed')

// Check connection statistics
const stats = getRpcStats()
console.log(`Active connections: ${stats.rpcConnections}`)
```

### Connection Lifecycle

```typescript
import { getSharedRpc, releaseRpcConnection } from '@connectorkit/sdk/core'

function useCustomRpc() {
  const rpc = getSharedRpc(rpcUrl, commitment)
  
  // Cleanup when component unmounts
  useEffect(() => {
    return () => releaseRpcConnection(rpcUrl, commitment)
  }, [rpcUrl, commitment])
  
  return rpc
}
```

## Error Handling System

Enterprise-grade error classification and recovery system with 20+ specific error types.

### Error Classification

```typescript
import { ArcError, ArcErrorCode } from '@connectorkit/sdk/core'

// Errors are automatically classified
try {
  await someRpcCall()
} catch (error) {
  if (error instanceof ArcError) {
    switch (error.code) {
      case ArcErrorCode.RATE_LIMITED:
        // Handle rate limiting
        break
      case ArcErrorCode.INSUFFICIENT_FUNDS:
        // Show balance warning
        break
      case ArcErrorCode.USER_REJECTED:
        // Transaction was cancelled
        break
    }
  }
}
```

### Error Recovery

```typescript
import { defaultRetryManager } from '@connectorkit/sdk/core'

// Automatic retry with exponential backoff
const result = await defaultRetryManager.executeWithRetry(
  () => rpc.getBalance(address),
  { operation: 'getBalance', address }
)
```

### User-Friendly Messages

```typescript
import { formatErrorForUser } from '@connectorkit/sdk/core'

try {
  await sendTransaction()
} catch (error) {
  // Automatically converts technical errors to user-friendly messages
  const userMessage = formatErrorForUser(error)
  toast.error(userMessage) // "Insufficient balance for this transaction"
}
```

## Provider System

Extensible plugin architecture for swap providers, with future support for lending, staking, and more.

### Creating a Swap Provider

```typescript
import { SwapProvider, SwapParams, SwapQuote } from '@connectorkit/sdk/core'

class CustomSwapProvider implements SwapProvider {
  name = 'Custom DEX'
  
  async quote(params: SwapParams): Promise<SwapQuote> {
    // Implement quote logic
    return {
      provider: this.name,
      inputMint: params.inputMint,
      outputMint: params.outputMint,
      inputAmount: params.amount,
      outputAmount: calculatedOutput,
      priceImpact: 0.1,
      fees: 5000n
    }
  }
  
  async build({ quote, userPublicKey }) {
    // Return transaction instructions or prebuilt transaction
    return {
      kind: 'instructions',
      instructions: [/* swap instructions */]
    }
  }
  
  isTokenSupported(mint: Address): boolean {
    // Check if token is supported
    return supportedTokens.includes(mint)
  }
}
```

### Registering Providers

```typescript
import { createProvider } from '@connectorkit/sdk/core'

const provider = createProvider({
  swap: [
    new JupiterProvider(),
    new OrcaProvider(), 
    new CustomSwapProvider()
  ]
})

// Use with ArcProvider
<ArcProvider providers={[provider]}>
  <App />
</ArcProvider>
```

## ArcProvider Configuration

The core provider component that enables all SDK functionality.

### Basic Setup

```tsx
import { ArcProvider } from '@connectorkit/sdk'

function App() {
  return (
    <ArcProvider
      network="devnet"
      rpcUrl="https://api.devnet.solana.com"
    >
      <YourApp />
    </ArcProvider>
  )
}
```

### Advanced Configuration

```tsx
import { ArcProvider, createProvider } from '@connectorkit/sdk'

const customProvider = createProvider({
  swap: [new JupiterProvider()]
})

function App() {
  return (
    <ArcProvider
      network="mainnet"
      rpcUrl="https://your-rpc-endpoint.com"
      providers={[customProvider]}
      config={{
        commitment: 'finalized',
        maxRetries: 5,
        retryDelay: 1000
      }}
    >
      <YourApp />
    </ArcProvider>
  )
}
```

## Performance Monitoring

Built-in tools to monitor and optimize your app's performance.

### Connection Statistics

```typescript
import { getRpcStats } from '@connectorkit/sdk/core'

function DebugPanel() {
  const stats = getRpcStats()
  
  return (
    <div>
      <p>RPC Connections: {stats.rpcConnections}</p>
      <p>WebSocket Connections: {stats.wsConnections}</p>
      <p>Memory Footprint: {stats.totalMemoryFootprint}</p>
    </div>
  )
}
```

### Request Monitoring

```typescript
import { createHttpTransport } from '@connectorkit/sdk/transports'

const transport = createHttpTransport({
  url: rpcUrl,
  retry: { attempts: 3, strategy: 'exponential' },
  timeoutMs: 10000,
  onRequest: ({ id, method }) => console.log(`Request ${id}: ${method}`),
  onResponse: ({ id, ms }) => console.log(`Response ${id}: ${ms}ms`),
  onError: ({ id, error }) => console.error(`Error ${id}:`, error)
})
```

## Best Practices

### Connection Management

```typescript
// ✅ Good - Use shared connections
const rpc = getSharedRpc(rpcUrl, commitment)

// ❌ Bad - Creates new connection every time
const rpc = createSolanaRpc(rpcUrl)
```

### Error Handling

```typescript
// ✅ Good - Handle specific error types
try {
  await operation()
} catch (error) {
  if (error instanceof ArcError) {
    if (error.isRetryable()) {
      // Retry logic
    } else {
      // Show user error
    }
  }
}

// ❌ Bad - Generic error handling
try {
  await operation()
} catch (error) {
  console.error(error) // Not helpful to users
}
```

### Provider Registration

```typescript
// ✅ Good - Register providers at app root
<ArcProvider providers={[swapProvider]}>

// ❌ Bad - Create providers in components
function Component() {
  const provider = createProvider({ swap: [...] }) // Creates new provider every render
}
```

## Next Steps

- **[Client](/docs/hooks/client)** - Server-side usage patterns
- **[Transports](/docs/hooks/transports)** - HTTP transport configuration
- **[Utils](/docs/hooks/utils)** - Utility functions and helpers
