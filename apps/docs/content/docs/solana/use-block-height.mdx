---
title: useBlockHeight
description: Hook to get the current block height with commitment level options
---

# useBlockHeight

The `useBlockHeight` hook fetches the current block height (number of confirmed blocks) from the Solana blockchain. Block height is a better timing primitive than slot for confirmation and finality calculations.

## Usage

### Direct Import
```tsx
import { useBlockHeight } from '@connectorkit/solana'

function BlockHeightDisplay() {
  const { blockHeight, blockHeightNumber, isLoading, error } = useBlockHeight({
    refreshInterval: 10000,
    commitment: 'confirmed'
  })
  
  if (isLoading) return <div>Loading block height...</div>
  if (error) return <div>Error: {error.message}</div>
  
  return (
    <div>
      <p>Current Block Height: {blockHeightNumber.toLocaleString()}</p>
      <p>Raw Value: {blockHeight?.toString()}</p>
    </div>
  )
}
```

### Copy Hook Code
```tsx
'use client'

import { useQuery } from '@tanstack/react-query'
import { useArcClient } from '../core/arc-client-provider'
import type { Transport } from '../transports/types'
import { queryKeys } from '../utils/query-keys'
import { 
  ArcError,
  createNetworkError,
  type ArcErrorContext
} from '../core/error-handler'

export interface UseBlockHeightOptions {
  refreshInterval?: number
  enabled?: boolean
  commitment?: 'processed' | 'confirmed' | 'finalized'
}

export interface UseBlockHeightReturn {
  blockHeight: bigint | null
  /** Block height as a regular number for easier math */
  blockHeightNumber: number
  isLoading: boolean
  error: ArcError | null
  refetch: () => void
}

/**
 * Get the current block height (number of confirmed blocks).
 *
 * Block height is often a better timing primitive than slot because:
 * - It only counts confirmed blocks, not all slots
 * - It's more stable and predictable for timing logic
 * - It's better for calculating finality and confirmation depths
 * 
 * Use this for:
 * - Transaction confirmation counting
 * - Finality calculations (e.g., "wait 32 blocks")
 * - Time-based logic that needs confirmed state
 */
export function useBlockHeight(
  options: UseBlockHeightOptions = {}
): UseBlockHeightReturn {
  const { network } = useArcClient()
  
  const {
    refreshInterval = 15000,
    enabled = true,
    commitment = 'confirmed',
  } = options

  const query = useQuery<bigint, ArcError>({
    networkMode: "offlineFirst",
    queryKey: [...queryKeys.blockHeight(network.rpcUrl), commitment],
    queryFn: async ({ signal }) => {
      const context: ArcErrorContext = {
        operation: 'getBlockHeight',
        timestamp: Date.now(),
        rpcUrl: network.rpcUrl
      }

      try {
        const transport = (useArcClient() as any).config.transport as Transport
        const result: any = await transport.request(
          { method: 'getBlockHeight', params: [ { commitment } ] },
          { signal }
        )
        const raw = result
        return typeof raw === 'bigint' ? raw : BigInt(raw ?? 0)

      } catch (error) {
        const errorMessage = error instanceof Error ? error.message : String(error)
        throw createNetworkError(
          `Failed to fetch block height: ${errorMessage}`,
          context,
          error as Error
        )
      }
    },
    enabled: enabled,
    refetchInterval: refreshInterval,
    refetchOnWindowFocus: false,
    staleTime: 5_000,
    gcTime: 5 * 60_000,
    retry: 1,
    notifyOnChangeProps: ['data', 'error', 'isLoading'],
  })

  const blockHeight = query.data ?? null
  const blockHeightNumber = blockHeight ? Number(blockHeight) : 0

  return {
    blockHeight,
    blockHeightNumber,
    isLoading: query.isLoading,
    error: query.error ?? null,
    refetch: query.refetch,
  }
}
```

## Parameters

- `refreshInterval?: number` - How often to refresh data in milliseconds (default: 15000)
- `enabled?: boolean` - Whether the query is enabled (default: true)
- `commitment?: 'processed' | 'confirmed' | 'finalized'` - Commitment level (default: 'confirmed')

## Return Value

- `blockHeight: bigint | null` - The current block height as a BigInt
- `blockHeightNumber: number` - Block height as a regular number for easier math
- `isLoading: boolean` - Whether the block height is loading
- `error: ArcError | null` - Any error that occurred
- `refetch: () => void` - Function to manually refetch the block height

## Example

```tsx
import { useBlockHeight } from '@connectorkit/solana'
import { useEffect, useState } from 'react'

function BlockHeightMonitor() {
  const {
    blockHeight,
    blockHeightNumber,
    isLoading,
    error,
    refetch
  } = useBlockHeight({
    refreshInterval: 5000, // Update every 5 seconds
    commitment: 'confirmed'
  })

  const [previousHeight, setPreviousHeight] = useState<number>(0)
  const [blocksAdded, setBlocksAdded] = useState<number>(0)

  useEffect(() => {
    if (blockHeightNumber && blockHeightNumber !== previousHeight) {
      if (previousHeight > 0) {
        setBlocksAdded(blockHeightNumber - previousHeight)
      }
      setPreviousHeight(blockHeightNumber)
    }
  }, [blockHeightNumber, previousHeight])

  if (isLoading && !blockHeight) {
    return (
      <div style={{ padding: '16px', textAlign: 'center' }}>
        <div>Loading current block height...</div>
      </div>
    )
  }

  if (error) {
    return (
      <div style={{ padding: '16px', color: 'red' }}>
        <div>Error loading block height: {error.message}</div>
        <button onClick={() => refetch()}>Retry</button>
      </div>
    )
  }

  return (
    <div style={{ padding: '16px' }}>
      <h3>Solana Block Height Monitor</h3>
      
      <div style={{ display: 'grid', gap: '8px', marginBottom: '16px' }}>
        <div>
          <strong>Current Block Height:</strong> {blockHeightNumber.toLocaleString()}
        </div>
        
        <div>
          <strong>Raw Value:</strong> {blockHeight?.toString()}
        </div>
        
        {blocksAdded > 0 && (
          <div style={{ color: '#4CAF50' }}>
            <strong>Blocks Added:</strong> +{blocksAdded}
          </div>
        )}
        
        <div style={{ fontSize: '12px', color: '#666' }}>
          Updates every 5 seconds â€¢ Commitment: confirmed
        </div>
      </div>

      <button 
        onClick={() => refetch()}
        style={{
          padding: '8px 16px',
          backgroundColor: '#2196F3',
          color: 'white',
          border: 'none',
          borderRadius: '4px',
          cursor: 'pointer'
        }}
      >
        Refresh Now
      </button>
    </div>
  )
}
```

## Block Height vs Slot

**Block Height** (recommended for most use cases):
- Only counts confirmed blocks
- More stable and predictable
- Better for finality calculations
- Use for: transaction confirmations, timing logic

**Slot** (for lower-level operations):
- Counts all slots, including empty ones
- Updates more frequently
- Less stable, can have gaps
- Use for: precise timing, slot-based calculations

## Use Cases

- **Transaction Confirmation**: Count blocks since transaction submission
- **Finality Calculations**: Determine when transactions are considered final
- **Time-based Logic**: Implement features that depend on confirmed state
- **Network Monitoring**: Track network block production rate
- **Staking Rewards**: Calculate epoch and block-based rewards

## Notes

- Block height is more stable than slot for timing calculations
- Uses confirmed commitment by default for reliability
- Automatically handles BigInt conversion for JavaScript compatibility
- Includes comprehensive error handling with network error context
- Caches data for 5 seconds to reduce unnecessary requests